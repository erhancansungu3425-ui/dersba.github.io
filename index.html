<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Pro AI | Ortaokul AsistanÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        
        :root {
            --primary: #6366f1;
            --bg: #0b0f1a;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: #f1f5f9;
            overflow: hidden;
        }

        .glass-panel {
            background: rgba(22, 27, 44, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 2rem;
        }

        .screen { 
            display: none; 
            opacity: 0; 
            will-change: transform, opacity;
            transition: opacity 0.3s ease, transform 0.3s ease; 
        }
        .screen.active { display: block; opacity: 1; transform: translateY(0); }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

        .gradient-text {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .schedule-card {
            border-left: 3px solid #6366f1;
            background: rgba(255,255,255,0.03);
            transition: all 0.2s;
        }
        .schedule-card:hover {
            background: rgba(255,255,255,0.07);
            transform: translateX(5px);
        }

        .ai-glow {
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
            animation: pulse-glow 2s infinite ease-in-out;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.5); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- MAIN CONTAINER -->
    <div class="w-full max-w-[420px] h-[850px] max-h-[95vh] glass-panel shadow-2xl overflow-hidden flex flex-col relative">
        
        <!-- HEADER -->
        <header id="appNav" class="hidden px-6 py-4 flex justify-between items-center border-b border-white/5 bg-white/5 z-20">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center border border-indigo-500/30">
                    <i class="fa-solid fa-brain text-indigo-400 text-sm"></i>
                </div>
                <span id="appHeaderTitle" class="text-[10px] font-bold tracking-widest uppercase text-slate-400">Nova AI v3.7</span>
            </div>
            <div class="flex gap-3">
                <button onclick="showScreen('statsScreen')" class="text-slate-400 hover:text-white transition"><i class="fa-solid fa-chart-line"></i></button>
                <button onclick="resetApp()" class="text-red-400/50 hover:text-red-400 transition"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto custom-scrollbar relative px-6 py-4">
            
            <!-- WELCOME SCREEN -->
            <div id="welcomeScreen" class="screen active text-center h-full flex flex-col justify-center">
                <div class="mb-8">
                    <div class="w-24 h-24 bg-gradient-to-tr from-indigo-600 to-purple-600 rounded-3xl flex items-center justify-center mx-auto shadow-2xl rotate-3">
                        <i class="fa-solid fa-graduation-cap text-4xl text-white"></i>
                    </div>
                </div>
                <h1 class="text-4xl font-black mb-4 tracking-tight">NOVA <span class="gradient-text">PRO</span></h1>
                <p class="text-slate-400 text-sm mb-10">âœ¨ AI destekli akÄ±llÄ± ortaokul asistanÄ±n.</p>
                <button onclick="showScreen('setupScreen')" class="w-full py-5 bg-indigo-600 hover:bg-indigo-500 rounded-2xl font-bold shadow-xl shadow-indigo-600/20 active:scale-95 transition">
                    BaÅŸlayalÄ±m
                </button>
            </div>

            <!-- SETUP SCREEN -->
            <div id="setupScreen" class="screen">
                <h2 class="text-2xl font-bold mb-6 mt-4">Profilini OluÅŸtur</h2>
                <div class="space-y-5">
                    <div class="p-4 bg-white/5 rounded-2xl border border-white/10">
                        <label class="text-[10px] uppercase font-black text-indigo-400 mb-2 block">AdÄ±n</label>
                        <input id="userName" type="text" placeholder="Ä°smin nedir?" class="w-full bg-transparent outline-none text-lg font-semibold text-white">
                    </div>
                    <div class="p-4 bg-white/5 rounded-2xl border border-white/10">
                        <label class="text-[10px] uppercase font-black text-indigo-400 mb-2 block">SÄ±nÄ±fÄ±n</label>
                        <select id="userGrade" class="w-full bg-transparent outline-none text-lg font-semibold text-white appearance-none cursor-pointer">
                            <option value="5" class="bg-[#0b0f1a]">5. SÄ±nÄ±f</option>
                            <option value="6" class="bg-[#0b0f1a]">6. SÄ±nÄ±f</option>
                            <option value="7" class="bg-[#0b0f1a]">7. SÄ±nÄ±f</option>
                            <option value="8" class="bg-[#0b0f1a]">8. SÄ±nÄ±f (LGS Modu)</option>
                        </select>
                    </div>
                    <button onclick="completeSetup()" class="w-full py-4 bg-white text-black rounded-2xl font-bold mt-4 active:scale-95 transition">
                        Nova'yÄ± HazÄ±rla
                    </button>
                </div>
            </div>

            <!-- DASHBOARD -->
            <div id="mainDashboard" class="screen">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center font-bold text-xl" id="avatarInitial">?</div>
                    <div>
                        <h2 id="displayUserName" class="text-xl font-bold">...</h2>
                        <div class="flex gap-2">
                            <span id="displayGrade" class="text-[10px] px-2 py-0.5 rounded text-white font-bold">SINIF</span>
                            <span id="modeTag" class="text-[10px] bg-indigo-500/10 px-2 py-0.5 rounded text-indigo-400 font-bold uppercase tracking-wider italic">GÃœNLÃœK TAKÄ°P</span>
                        </div>
                    </div>
                </div>

                <!-- âœ¨ AI MOTIVATION CARD -->
                <div id="motivationContainer" class="mb-6 p-4 border rounded-3xl relative overflow-hidden hidden ai-glow">
                    <div class="absolute top-2 right-2 flex gap-2">
                        <button onclick="speakMotivation()" class="text-indigo-400 hover:text-indigo-200 transition"><i class="fa-solid fa-volume-high"></i></button>
                    </div>
                    <p id="motivationText" class="text-xs italic leading-relaxed pr-8 font-semibold">AI analiz yapÄ±yor...</p>
                    <div class="mt-2 text-[9px] font-bold uppercase tracking-tighter" id="motivationSource">â€” Nova AI</div>
                </div>

                <!-- ACTIONS -->
                <div class="mb-6 grid grid-cols-2 gap-3">
                    <button onclick="generateDailyRecap()" class="p-4 bg-indigo-600/10 border border-indigo-500/20 rounded-3xl flex flex-col items-center gap-2 hover:bg-indigo-600/20 transition group">
                        <i class="fa-solid fa-calendar-check text-indigo-400 group-hover:scale-110 transition"></i>
                        <span class="text-[10px] font-black uppercase">GÃ¼nlÃ¼k Tekrar</span>
                    </button>
                    <button onclick="generateAIStrategy()" class="p-4 bg-purple-600/10 border border-purple-500/20 rounded-3xl flex flex-col items-center gap-2 hover:bg-purple-600/20 transition group">
                        <i class="fa-solid fa-chess-knight text-purple-400 group-hover:scale-110 transition"></i>
                        <span class="text-[10px] font-black uppercase tracking-tight">âœ¨ AI Strateji</span>
                    </button>
                </div>

                <!-- MOOD SELECTOR -->
                <div class="mb-6">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase mb-3 px-1">BugÃ¼n NasÄ±l Hissediyorsun?</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="setMoodAndPlan('happy')" class="mood-btn p-4 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/50 transition flex flex-col items-center gap-1">
                            <span class="text-2xl">âš¡</span>
                            <span class="text-[8px] font-bold text-slate-400 uppercase">Enerjik</span>
                        </button>
                        <button onclick="setMoodAndPlan('normal')" class="mood-btn p-4 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/50 transition flex flex-col items-center gap-1">
                            <span class="text-2xl">ðŸ“–</span>
                            <span class="text-[8px] font-bold text-slate-400 uppercase">Dengeli</span>
                        </button>
                        <button onclick="setMoodAndPlan('tired')" class="mood-btn p-4 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/50 transition flex flex-col items-center gap-1">
                            <span class="text-2xl">ðŸ”‹</span>
                            <span class="text-[8px] font-bold text-slate-400 uppercase">DÃ¼ÅŸÃ¼k</span>
                        </button>
                        <button onclick="setMoodAndPlan('stressed')" class="mood-btn p-4 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/50 transition flex flex-col items-center gap-1">
                            <span class="text-2xl">ðŸ§ </span>
                            <span class="text-[8px] font-bold text-slate-400 uppercase">YoÄŸun</span>
                        </button>
                    </div>
                </div>

                <!-- AI DYNAMIC SCHEDULE -->
                <div id="scheduleSection" class="mb-8 hidden">
                    <div class="flex items-center justify-between mb-4 px-1">
                        <h3 id="scheduleTitle" class="text-[10px] font-black uppercase tracking-widest">âœ¨ AI AkÄ±llÄ± Program</h3>
                        <span id="currentMoodTag" class="text-[9px] px-2 py-0.5 rounded-full font-bold">...</span>
                    </div>
                    <div id="aiScheduleContainer" class="space-y-3"></div>
                </div>

                <!-- TOOLS & TIMER -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div id="timerCard" class="col-span-2 p-6 bg-white/5 border border-white/10 rounded-[2.5rem] flex items-center justify-between">
                        <div class="text-left">
                            <div id="timerDisplay" class="text-4xl font-mono font-black tracking-tighter">25:00</div>
                            <div id="timerLabel" class="text-[9px] font-bold text-slate-500 uppercase mt-1">Odaklanma SayacÄ±</div>
                        </div>
                        <button id="timerBtn" onclick="toggleTimer()" class="w-14 h-14 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition">
                            <i class="fa-solid fa-play"></i>
                        </button>
                    </div>
                    
                    <button onclick="showScreen('examScreen')" class="p-5 bg-white/5 border border-white/10 rounded-3xl hover:bg-white/10 transition group">
                        <i class="fa-solid fa-check-double text-emerald-400 mb-2"></i>
                        <div class="text-[11px] font-bold">Veri GiriÅŸi</div>
                    </button>
                    
                    <button onclick="showScreen('solveScreen')" class="p-5 bg-white/5 border border-white/10 rounded-3xl hover:bg-white/10 transition group">
                        <i class="fa-solid fa-wand-magic-sparkles text-indigo-400 mb-2"></i>
                        <div class="text-[11px] font-bold">âœ¨ AI Soru Ã‡Ã¶z</div>
                    </button>

                    <button onclick="showScreen('searchScreen')" class="col-span-2 p-5 bg-white/5 border border-white/10 rounded-3xl hover:bg-white/10 transition flex items-center justify-center gap-3">
                        <i class="fa-solid fa-book-open text-amber-400"></i>
                        <div class="text-[12px] font-black uppercase tracking-wider">âœ¨ AI Konu AsistanÄ±</div>
                    </button>
                </div>
            </div>

            <!-- EXAM SCREEN -->
            <div id="examScreen" class="screen">
                <button onclick="showScreen('mainDashboard')" class="mb-6 text-slate-400 text-xs flex items-center gap-1"><i class="fa-solid fa-arrow-left"></i> Geri</button>
                <h2 class="text-2xl font-bold mb-6">Analiz GiriÅŸi</h2>
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-white/5 rounded-2xl">
                            <label class="text-[10px] font-bold text-emerald-400 uppercase">DoÄŸru</label>
                            <input id="netD" type="number" class="w-full bg-transparent text-3xl font-black outline-none mt-2" placeholder="0">
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl">
                            <label class="text-[10px] font-bold text-red-400 uppercase">YanlÄ±ÅŸ</label>
                            <input id="netY" type="number" class="w-full bg-transparent text-3xl font-black outline-none mt-2" placeholder="0">
                        </div>
                    </div>
                    <div class="p-4 bg-white/5 rounded-2xl">
                        <label class="text-[10px] font-bold text-indigo-400 uppercase">Ders SeÃ§imi</label>
                        <select id="weakLesson" class="w-full bg-transparent font-bold mt-2 outline-none">
                            <option value="Matematik" class="bg-[#0b0f1a]">Matematik</option>
                            <option value="TÃ¼rkÃ§e" class="bg-[#0b0f1a]">TÃ¼rkÃ§e</option>
                            <option value="Fen" class="bg-[#0b0f1a]">Fen Bilimleri</option>
                        </select>
                    </div>
                    <button onclick="saveExam()" class="w-full py-5 bg-indigo-600 rounded-2xl font-bold uppercase">Veriyi Kaydet</button>
                </div>
            </div>

            <!-- AI SEARCH SCREEN -->
            <div id="searchScreen" class="screen">
                <button onclick="showScreen('mainDashboard')" class="mb-6 text-slate-400 text-xs flex items-center gap-1"><i class="fa-solid fa-arrow-left"></i> Geri</button>
                <h2 class="text-2xl font-bold mb-2">âœ¨ AI Konu AsistanÄ±</h2>
                <div class="relative mb-6">
                    <input id="topicQuery" type="text" placeholder="Hangi konuyu anlamadÄ±n?" class="w-full bg-white/5 border border-white/10 p-4 pr-12 rounded-2xl outline-none focus:border-indigo-500 transition">
                    <button onclick="aiSearch()" class="absolute right-4 top-4 text-indigo-400"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
                <div id="searchResult" class="space-y-4"></div>
            </div>

            <!-- AI SOLVE SCREEN -->
            <div id="solveScreen" class="screen">
                <button onclick="showScreen('mainDashboard')" class="mb-6 text-slate-400 text-xs flex items-center gap-1"><i class="fa-solid fa-arrow-left"></i> Geri</button>
                <h2 class="text-2xl font-bold mb-2">âœ¨ AI Soru Ã‡Ã¶zÃ¼cÃ¼</h2>
                <div class="space-y-4">
                    <textarea id="questionInput" placeholder="Soru metni..." class="w-full h-32 bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-indigo-500 transition text-sm"></textarea>
                    <button onclick="solveQuestion()" class="w-full py-4 bg-indigo-600 rounded-2xl font-bold">âœ¨ MantÄ±k YÃ¼rÃ¼t ve Ã‡Ã¶z</button>
                </div>
                <div id="solveResult" class="mt-6"></div>
            </div>

            <!-- STATS SCREEN -->
            <div id="statsScreen" class="screen">
                <button onclick="showScreen('mainDashboard')" class="mb-6 text-slate-400 text-xs flex items-center gap-1"><i class="fa-solid fa-arrow-left"></i> Geri</button>
                <h2 class="text-2xl font-bold mb-2">GeliÅŸim Karnen</h2>
                <div id="aiStrategyOutput" class="mb-6"></div>
                <div id="statsList" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        let user = JSON.parse(localStorage.getItem('nova_multi_v1')) || null;
        let timer = null;
        let timeLeft = 25 * 60; 
        let isRunning = false;

        // --- CORE AI FUNCTIONS (CLEANED OF BRAND NAMES) ---
        async function callAI(prompt, system = "Sen bir AI eÄŸitim asistanÄ±sÄ±n.") {
            const maxRetries = 5;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: system }] }
                        })
                    });
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (e) {
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, i)));
                }
            }
            return null;
        }

        async function generateAIImage(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: { prompt: `Infographic about: ${prompt}. Educational, simple.` },
                        parameters: { sampleCount: 1 }
                    })
                });
                const result = await response.json();
                return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
            } catch (e) { return null; }
        }

        async function speakAIText(text) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Say clearly in Turkish: ${text}` }] }],
                        generationConfig: { 
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } } 
                        }
                    })
                });
                const data = await response.json();
                const pcmData = data.candidates[0].content.parts[0].inlineData.data;
                const audioBlob = pcmToWav(pcmData, 24000);
                new Audio(URL.createObjectURL(audioBlob)).play();
            } catch (e) { console.error("Audio error", e); }
        }

        function pcmToWav(base64, sampleRate) {
            const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;
            const wavHeader = new ArrayBuffer(44);
            const view = new DataView(wavHeader);
            view.setUint32(0, 0x52494646, false); view.setUint32(4, 36 + buffer.byteLength, true);
            view.setUint32(8, 0x57415645, false); view.setUint32(12, 0x666d7420, false);
            view.setUint32(16, 16, true); view.setUint16(20, 1, true);
            view.setUint16(22, 1, true); view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true); view.setUint16(32, 2, true);
            view.setUint16(34, 16, true); view.setUint32(36, 0x64617461, false);
            view.setUint32(40, buffer.byteLength, true);
            return new Blob([wavHeader, buffer], { type: 'audio/wav' });
        }

        // --- APP FLOW ---
        window.onload = () => { if (user) { initDashboard(); showScreen('mainDashboard'); generateMotivation(); } };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => { s.style.display = 'none'; s.classList.remove('active'); });
            const target = document.getElementById(id);
            target.style.display = 'block';
            void target.offsetWidth;
            target.classList.add('active');
            document.getElementById('appNav').classList.toggle('hidden', id === 'welcomeScreen' || id === 'setupScreen');
            if(id === 'statsScreen') renderStats();
        }

        function completeSetup() {
            const name = document.getElementById('userName').value.trim();
            const grade = document.getElementById('userGrade').value;
            if(!name) return;
            user = { name, grade, exams: [], lastWeakLesson: 'Matematik', isLGS: grade == "8" };
            localStorage.setItem('nova_multi_v1', JSON.stringify(user));
            initDashboard();
            showScreen('mainDashboard');
        }

        function initDashboard() {
            document.getElementById('displayUserName').innerText = user.name;
            document.getElementById('avatarInitial').innerText = user.name[0].toUpperCase();
            document.getElementById('displayGrade').innerText = `${user.grade}. SINIF`;
            if(user.isLGS) timeLeft = 40 * 60;
            updateTimerDisplay();
        }

        async function generateMotivation() {
            const text = document.getElementById('motivationText');
            document.getElementById('motivationContainer').classList.remove('hidden');
            const res = await callAI(`Ben ${user.name}. ${user.grade}. sÄ±nÄ±f Ã¶ÄŸrencisi iÃ§in 10 kelimelik AI motivasyon sÃ¶zÃ¼ sÃ¶yle.`);
            if(res) text.innerText = res.replace(/"/g, '');
        }

        function speakMotivation() { speakAIText(document.getElementById('motivationText').innerText); }

        async function generateAIStrategy() {
            showScreen('statsScreen');
            const output = document.getElementById('aiStrategyOutput');
            output.innerHTML = '<div class="loading-shimmer h-32 rounded-2xl w-full"></div>';
            const context = user.exams.slice(0, 3).map(e => `${e.d} DoÄŸru, ${e.y} YanlÄ±ÅŸ (${e.lesson})`).join(', ');
            const strategy = await callAI(`Ã–ÄŸrenci sonuÃ§larÄ±: ${context}. 3 maddelik strateji raporu Ã§Ä±kar.`, "Sen bir AI eÄŸitim uzmanÄ±sÄ±n.");
            if(strategy) {
                output.innerHTML = `<div class="p-5 bg-purple-600/10 border border-purple-500/20 rounded-2xl text-[11px]">
                    <h3 class="font-black mb-2 uppercase tracking-widest"><i class="fa-solid fa-chess-knight"></i> AI Strateji Raporu</h3>
                    ${strategy.replace(/\n/g, '<br>')}
                </div>`;
            }
        }

        async function aiSearch() {
            const query = document.getElementById('topicQuery').value;
            if(!query) return;
            const resDiv = document.getElementById('searchResult');
            resDiv.innerHTML = '<div class="loading-shimmer h-64 rounded-2xl w-full"></div>';
            const [explanation, imageUrl] = await Promise.all([
                callAI(`${user.grade}. sÄ±nÄ±f iÃ§in "${query}" konusunu kÄ±saca Ã¶zetle.`),
                generateAIImage(query)
            ]);
            resDiv.innerHTML = `
                <div class="p-5 bg-white/5 border border-white/10 rounded-2xl text-xs">
                    <div class="mb-4">${explanation.replace(/\n/g, '<br>')}</div>
                    ${imageUrl ? `<img src="${imageUrl}" class="w-full rounded-xl mb-4">` : ''}
                    <button onclick="speakAIText('${explanation.replace(/'/g, "\\'")}')" class="w-full py-2 bg-indigo-500/10 rounded-lg text-[10px]">SESLÄ° DÄ°NLE</button>
                </div>
            `;
        }

        async function solveQuestion() {
            const question = document.getElementById('questionInput').value;
            if(!question) return;
            const resDiv = document.getElementById('solveResult');
            resDiv.innerHTML = '<div class="loading-shimmer h-40 rounded-2xl w-full"></div>';
            const solution = await callAI(`Soru: "${question}". Bu soruyu AI mantÄ±ÄŸÄ±yla adÄ±m adÄ±m Ã§Ã¶z.`);
            if(solution) {
                resDiv.innerHTML = `<div class="p-5 bg-indigo-600/10 border border-indigo-500/20 rounded-2xl text-[12px]">
                    <div class="text-indigo-400 font-black mb-2 uppercase">âœ¨ AI Analizi</div>
                    ${solution.replace(/\n/g, '<br>')}
                </div>`;
            }
        }

        async function setMoodAndPlan(mood) {
            const container = document.getElementById('aiScheduleContainer');
            document.getElementById('scheduleSection').classList.remove('hidden');
            container.innerHTML = '<div class="loading-shimmer h-20 rounded-xl w-full"></div>';
            const res = await callAI(`Mod: ${mood}, ZayÄ±f ders: ${user.lastWeakLesson}. Bana 3 gÃ¶revlik JSON dÃ¶ndÃ¼r: {"tasks": [{"time": "18:00", "title": "BaÅŸlÄ±k", "desc": "GÃ¶rev"}]}`, "Sadece JSON.");
            if(res) {
                try {
                    const data = JSON.parse(res.match(/\{.*\}/s)[0]);
                    container.innerHTML = data.tasks.map(t => `<div class="schedule-card p-4 rounded-2xl border border-white/5">
                        <div class="text-[9px] font-black text-indigo-400">${t.time}</div>
                        <div class="text-xs font-bold">${t.title}</div>
                        <div class="text-[9px] text-slate-400">${t.desc}</div>
                    </div>`).join('');
                } catch(e) { container.innerHTML = '<p class="text-xs">Program Ã¼retilemedi.</p>'; }
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('timerBtn');
            if(isRunning) { clearInterval(timer); btn.innerHTML = '<i class="fa-solid fa-play"></i>'; }
            else { timer = setInterval(() => { if(timeLeft <= 0) { clearInterval(timer); return; } timeLeft--; updateTimerDisplay(); }, 1000); btn.innerHTML = '<i class="fa-solid fa-pause"></i>'; }
            isRunning = !isRunning;
        }

        function updateTimerDisplay() {
            document.getElementById('timerDisplay').innerText = `${Math.floor(timeLeft / 60).toString().padStart(2, '0')}:${(timeLeft % 60).toString().padStart(2, '0')}`;
        }

        function saveExam() {
            user.exams.unshift({ date: new Date().toLocaleDateString('tr-TR'), d: document.getElementById('netD').value, y: document.getElementById('netY').value, lesson: document.getElementById('weakLesson').value });
            user.lastWeakLesson = document.getElementById('weakLesson').value;
            localStorage.setItem('nova_multi_v1', JSON.stringify(user));
            showScreen('mainDashboard');
        }

        function renderStats() {
            document.getElementById('statsList').innerHTML = user.exams.map(ex => `<div class="p-4 bg-white/5 rounded-2xl flex justify-between border-l-2 border-indigo-500">
                <div><div class="text-[10px] text-slate-500">${ex.date}</div><div class="text-sm font-bold">${ex.lesson}</div></div>
                <div class="text-right font-black">${ex.d}D / ${ex.y}Y</div>
            </div>`).join('');
        }

        function resetApp() { if(confirm("SÄ±fÄ±rlansÄ±n mÄ±?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
